<!DOCTYPE html>
<html lang="ko">
<head>
    <title>Vue3 + PrimeVue Sample</title>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=0.9, maximum-scale=1.8, minimum-scale=0.9, user-scalable=yes">

    <link href="css/primeicons.css" rel="stylesheet"/>
    <link href="/css/swiper-bundle.min.css" rel="stylesheet"/>
    <link href="css/custom.css" rel="stylesheet"/>
    <link href="css/overlayscrollbars.min.css" rel="stylesheet"/>

    <script src="js/vue.global.js"></script>
    <script src="js/primevue.min.js"></script>
    <script src="js/aura.js"></script>
    <script src="js/tailwindcss.js"></script>
    <script src="/js/swiper-bundle.min.js"></script>
    <script src="/js/overlayscrollbars.browser.es6.min.js"></script>

</head>
<body class="bg-gray-100">
<div id="app">
    <overlay-scrollbars style="max-height: 100vh;">
        <div class="max-w-4xl mx-auto p-6 space-y-6">
            <h1 class="text-2xl font-bold text-center">Vue3 + PrimeVue Sample <span class="text-cyan-600">(Tabs, Swiper)</span></h1>

            <p-toolbar class="justify-between">
                <template #center>
                    <div class="flex flex-wrap gap-2">
                        <a href="sample1.html">
                            <p-button label="Form" size="small" outlined/>
                        </a>
                        <a href="sample2.html">
                            <p-button label="Tabs/Swiper" size="small" outlined/>
                        </a>
                        <a href="sample3.html">
                            <p-button label="DataTable" size="small" outlined/>
                        </a>
                        <a href="sample4.html">
                            <p-button label="Tree/PickList" size="small" outlined/>
                        </a>
                        <a href="sample5.html">
                            <p-button label="Buttons" size="small" outlined/>
                        </a>
                        <a href="sample6.html">
                            <p-button label="Tag/Spinner/Toast" size="small" outlined/>
                        </a>
                        <a href="sample7.html">
                            <p-button label="Overlays" size="small" outlined/>
                        </a>
                    </div>
                </template>
            </p-toolbar>

            <section class="bg-white p-4 rounded shadow">
                <p-tabs class="menu-tab-list" v-model:value="selected">
                    <!-- 탭바 (p-tab-list 자체에 ref를 달아 $el로 DOM 접근) -->
                    <p-tab-list ref="tabListComp">
                        <div class="tab-header">
                            <button ref="prevBtnRef" type="button" class="tabs-nav-btn tabs-prev" aria-label="이전">
                                <i class="pi pi-chevron-left"></i>
                            </button>

                            <swiper
                                    class="tabs-swiper"
                                    :options="swiperOptions"
                                    @ready="onSwiperReady"
                            >
                                <template #default>
                                    <swiper-slide v-for="(t,i) in tabs" :key="t.key" class="tab-slide">
                                        <div class="tab-item-wrap">
                                            <!-- PassThrough(:pt)로 data-index를 부여 (필요 시 유지) -->
                                            <p-tab :value="i" :pt="getTabPT(i)">
                                                <span class="tab-text">{{ t.label }}</span>
                                                <button
                                                        type="button"
                                                        class="tab-close"
                                                        aria-label="닫기"
                                                        @click.stop="console && console.log('close click', t.key)"
                                                >
                                                    <i class="pi pi-times"></i>
                                                </button>
                                            </p-tab>
                                        </div>
                                    </swiper-slide>
                                </template>
                            </swiper>

                            <button ref="nextBtnRef" type="button" class="tabs-nav-btn tabs-next" aria-label="다음">
                                <i class="pi pi-chevron-right"></i>
                            </button>
                        </div>
                    </p-tab-list>

                    <!-- 탭 패널 -->
                    <p-tab-panels>
                        <p-tab-panel v-for="(t,i) in tabs" :key="t.key" :value="i">
                            <div class="text-gray-700">
                                {{ t.desc }}
                            </div>
                        </p-tab-panel>
                    </p-tab-panels>
                </p-tabs>
            </section>
        </div>
    </overlay-scrollbars>
</div>

<script>
    const {createApp, ref, onMounted, onBeforeUnmount, h, watch, nextTick, computed} = Vue;

    /* Swiper 래퍼: 내부 DOM refs를 ready 이벤트로 부모에 전달 */
    const SwiperComponent = {
        name: 'swiper',
        emits: ['ready'],
        props: {options: {type: Object, default: () => ({})}},
        setup(props, {slots, emit}) {
            const rootEl = ref(null);
            const wrapperEl = ref(null);
            let instance = null;

            onMounted(() => {
                instance = new Swiper(rootEl.value, props.options || {});
                emit('ready', {rootEl: rootEl.value, wrapperEl: wrapperEl.value, instance});
            });
            onBeforeUnmount(() => {
                if (instance && typeof instance.destroy === 'function') {
                    instance.destroy(true, true);
                }
            });

            return () =>
                h('div', {ref: rootEl, class: 'swiper'}, [
                    h('div', {ref: wrapperEl, class: 'swiper-wrapper'}, slots.default ? slots.default() : [])
                ]);
        }
    };

    const SwiperSlideComponent = {
        name: 'swiper-slide',
        setup(_, {slots}) {
            return () => h('div', {class: 'swiper-slide'}, slots.default ? slots.default() : []);
        }
    };

    /* ──────────────── App ──────────────── */
    const app = createApp({
        setup() {
            const tabs = ref([
                {key: 't1', label: '초과근무신청', desc: '탭 1 내용입니다.'},
                {key: 't2', label: '시설관리', desc: '탭 2 내용입니다.'},
                {key: 't3', label: '검사계획관리', desc: '탭 3 내용입니다.'},
                {key: 't4', label: '검사결과등록', desc: '탭 4 내용입니다.'},
                {key: 't5', label: '시설검사결과등록', desc: '탭 5 내용입니다.'},
                {key: 't6', label: '시설검사결과등록', desc: '탭 6 내용입니다.'},
            ]);
            const selected = ref(0);

            // p-tab-list 컴포넌트 ref → DOM은 $el
            const tabListComp = ref(null);
            const tabListEl = computed(() => tabListComp.value ? tabListComp.value.$el : null);

            // Swiper 및 네비 버튼 refs
            const swiperWrapperEl = ref(null);
            const prevBtnRef = ref(null);
            const nextBtnRef = ref(null);

            // Swiper 옵션
            const swiperOptions = {
                slidesPerView: 5,
                spaceBetween: 5,
                watchOverflow: false,
                navigation: {
                    nextEl: '.menu-tab-list .tabs-next',
                    prevEl: '.menu-tab-list .tabs-prev'
                }
            };

            // PT 헬퍼: 각 탭 루트/액션에 data-index를 부여
            const getTabPT = (i) => ({
                root: {'data-index': i},
                action: {'data-index': i}
            });

            // Swiper ready 콜백 (인스턴스만 보관, 추가 로직 없음)
            const onSwiperReady = ({wrapperEl, instance}) => {
                swiperWrapperEl.value = wrapperEl;
                // instance를 써야 한다면 여기서 사용; 현재 seam 관련 로직 제거로 별도 사용 없음.
            };

            // 선택 변경 반응 (seam 관련 로직 제거로 별도 동작 없음)
            watch(selected, async () => {
                await nextTick();
                // no-op
            });

            // 마운트/언마운트 훅 (seam 관련 리스너 제거로 현재 특별한 작업 없음)
            onMounted(() => {
            });
            onBeforeUnmount(() => {
            });

            return {
                tabs, selected,
                swiperOptions,
                tabListComp,
                prevBtnRef, nextBtnRef,
                onSwiperReady,
                getTabPT
            };
        },
    });

    // PrimeVue 등록
    app.use(PrimeVue.Config, {theme: {preset: PrimeUIX.Themes.Aura}});
    const {Tabs, TabList, Tab, TabPanels, TabPanel, Toolbar, Button} = PrimeVue;
    app.component('p-tabs', Tabs);
    app.component('p-tab-list', TabList);
    app.component('p-tab', Tab);
    app.component('p-tab-panels', TabPanels);
    app.component('p-tab-panel', TabPanel);
    app.component('p-toolbar', Toolbar);
    app.component('p-button', Button);

    // Swiper 컴포넌트 등록
    app.component('swiper', SwiperComponent);
    app.component('swiper-slide', SwiperSlideComponent);

    app.component('overlay-scrollbars', {
        props: ['style', 'class'],
        mounted() {
            window.OverlayScrollbarsGlobal.OverlayScrollbars(this.$el, {scrollbars: {autoHide: 'scroll'}});
        },
        render() {
            return Vue.h('div', {style: this.style, class: this.class}, this.$slots.default());
        }
    });

    app.mount('#app');
</script>
</body>
</html>